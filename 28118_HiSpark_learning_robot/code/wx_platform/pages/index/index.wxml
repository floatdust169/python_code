<view class="container">
    <image class="bg-image" src="/pic/bg.jpg" mode="aspectFill" style="height:1800rpx;"></image>

    <!-- 标题 -->
    <view class="title">
        <text>云上智学平台</text>
    </view>

    <!-- 状态显示区域 - 同行显示 -->
    <view class="status-row">
        <image src="/pic/服务器.png"></image>
        <view class="status-item server-status">
            <text class="status-label">云服务器:</text>
            <text class="status-value {{statusClass}}">{{statusText}}</text>
        </view>

        <image src="/pic/设备.png"></image>
        <view class="status-item device-status">
            <text class="status-label">设备:</text>
            <text class="status-value {{deviceOnline ? 'status-connected' : 'status-disconnected'}}">{{deviceOnline ? '在线' : '离线'}}
            </text>
        </view>
    </view>

    <!-- 连接服务器按钮 -->
    <button class="connect-btn {{connectStatus === 'connected' ? 'connected' : ''}}" bindtap="toggleConnect">
        {{connectStatus === 'connected' ? '断开连接' : '连接云服务器'}}
    </button>

    <!-- 环境监测区域 -->
    <view class="control-section">
        <view class="control-head">
            <image src="/pic/环境.png"></image>
            <text class="control-title">环境监控</text>
        </view>

        <view class="environment-row">
            <view class="show_t">
                <image src="/pic/温度.png"></image>
                <text class="status-label">温度: {{temperature}}°C</text>
            </view>

            <view class="show_h">
                <image src="/pic/湿度.png"></image>
                <text class="status-label">湿度: {{humidity}}%</text>
            </view>
        </view>
    </view>

    <!-- Todolist区域 -->
    <view class="todolist-section">
        <!-- 表头 -->
        <view class="todolist_top">
            <view class="todolist-title">
                <image src="/pic/list.png"></image>
            </view>

            <view class="switch-btn">
                <view>
                    <button class="view-btn {{currentView === 'push' ? 'active' : ''}}" bindtap="switchView" data-view="push">推送</button>
                </view>
                <view>
                    <button class="view-btn {{currentView === 'progress' ? 'active' : ''}}" bindtap="switchView" data-view="progress">进度</button>
                </view>
            </view>

            <view class="send-button">
                <button bindtap="sendTaskList">发送</button>
            </view>
            <view class="clear-button">
                <button bindtap="clearCurrentView">x</button>
            </view>
            <view class="add-button">
                <button bindtap="addNewLine">+</button>
            </view>
        </view>
        <!-- 分割线 -->
        <view class="line">
            <text>-----------------------------------------------------------------</text>
        </view>
        <!-- 输入区域 -->
        <view wx:if="{{currentView === 'push'}}" class="task-list">
            <scroll-view class="scroll-area" scroll-y enhanced scroll-with-animation style="height: {{scrollHeight}}px">
                <view class="input-area">
                    <block wx:for="{{inputLines}}" wx:key="index">
                        <view class="input-line">
                            <button class="clear" data-index="{{index}}" bindtap="removeLine">
                                <image src="/pic/圆.png"></image>
                            </button>
                            <input class="todo-input" placeholder="输入新任务..." value="{{item.value}}" data-index="{{index}}" bindinput="onInput" confirm-type="done" bindconfirm="addTask" />
                        </view>
                    </block>
                </view>
            </scroll-view>
        </view>

        <view wx:if="{{currentView === 'progress'}}" class="completed-tasks">
            <scroll-view class="scroll-area" scroll-y enhanced scroll-with-animation style="height: {{scrollHeight}}px">
                <view class="task-list">
                    <block wx:for="{{completedTasks}}" wx:key="index">
                        <view class="completed-task">
                            <!-- 左侧图标 -->
                            <image class="task-icon" src="/pic/完成.png"></image>

                            <!-- 右侧上下分列的文本区域 -->
                            <view class="text-container">
                                <text class="task-name">完成任务：{{item.task}}</text>
                                <text class="task-time">完成时间：{{item.time}}</text>
                            </view>
                        </view>
                    </block>
                    <view wx:if="{{completedTasks.length === 0}}" class="empty-tasks">
                        <text>暂无已完成的学习任务</text>
                    </view>
                </view>
            </scroll-view>
        </view>
    </view>

    <view class="notice">
        <view class="notice-head">
            <image src="/pic/monitor_in.png"></image>
            <text class="notice-title">使用说明</text>
        </view>

        <view class="text-container">
            <text class="instruction">1. 请确保设备连接热点/路由器正常，设备连接正常，指示灯将亮起。若设备未连接上服务器，重启或许有效\n2. 小程序端需要连接服务器方可和设备交互\n3. 我们不会涉及您的隐私，遇到问题联系客服</text>
        </view>

    </view>
</view>